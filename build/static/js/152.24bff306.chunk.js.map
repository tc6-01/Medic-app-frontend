{"version":3,"file":"static/js/152.24bff306.chunk.js","mappings":"2PAkBO,SAASA,IACd,IAAMC,GAAeC,EAAAA,EAAAA,IAASC,EAAAA,GACxBC,GAA2BF,EAAAA,EAAAA,IAASG,EAAAA,GAC1C,GAA0BC,EAAAA,EAAAA,UAAgB,IAAG,eAAtCC,EAAK,KAAEC,EAAQ,KACtB,OAAO,0BACFP,GACAG,GAAwB,IAC3BG,MAAAA,EACAC,SAAAA,GAEJ,C,iHCOA,EAxBmC,SAAH,GAAkE,IAA5DC,EAAQ,EAARA,SAAUC,EAAkB,EAAlBA,mBAC5C,OACI,SAACC,EAAA,EAAK,CAACC,EAAG,EAAE,UACR,UAACC,EAAA,EAAG,CAACC,aAAc,EAAE,WACjB,SAACC,EAAA,EAAc,CAACN,SAAUA,KAC1B,SAACO,EAAA,EAAO,CAACC,MAAM,2BAAM,UACjB,SAACC,EAAA,EAAY,CAACC,MAAO,EACjB,SAACC,EAAA,EAAa,CAACC,MAAM,SAACC,EAAA,EAAa,CAACC,SAAS,UAAYC,KAAM,eAAMC,QAAS,kBAAMf,EAAmB,OAAO,KAC9G,SAACU,EAAA,EAAa,CAACC,MAAM,SAACK,EAAA,EAAK,CAACH,SAAS,UAAYC,KAAM,eAAMC,QAAS,kBAAMf,EAAmB,QAAQ,UAG/G,SAACM,EAAA,EAAO,CAACC,MAAM,2BAAM,UACjB,SAACC,EAAA,EAAY,CAACC,MAAO,EACjB,SAACC,EAAA,EAAa,CAACC,MAAM,SAACM,EAAA,EAAY,CAACJ,SAAS,UAAYC,KAAM,2BAAQC,QAAS,kBAAMf,EAAmB,SAAS,aAQzI,E,wCC0EA,EA1F0B,WAAO,IAAD,EACxBkB,GAAOC,EAAAA,EAAAA,MACPC,GAAS5B,EAAAA,EAAAA,IAASF,GAClB+B,GAAe7B,EAAAA,EAAAA,IAAS8B,EAAAA,IAC9BC,EAAAA,EAAAA,YAAU,YACRC,EAAAA,EAAAA,MAAgBC,MAAK,SAAAC,GACfA,GAAoB,MAAbA,EAAIC,OACTC,MAAMC,QAAQH,EAAII,OACpBV,EAAOtB,SAAS4B,EAAII,KAAKC,KAAI,SAACC,EAAMC,GAClC,MAAO,CACHC,GAAIF,EAAKE,GACTnC,SAAUiC,EAAKjC,SACfoC,SAAUH,EAAKG,SACfC,MAAO,SACPC,KAAML,EAAKK,KACXC,IAAKN,EAAKM,IACVC,SAAUP,EAAKO,SACfC,OAAQR,EAAKQ,OACbC,QAAQT,EAAKS,QAEnB,KACArB,EAAOsB,YAAW,IAElBtB,EAAOtB,SAAS,CAAC4B,EAAII,OAG3B,GACF,GAAG,IAGH,IAyBM9B,EAAqB,SAAC2C,GAC1B,IAAMC,EAAWxB,EAAOvB,MAAM8C,GAAOJ,SAAWnB,EAAOvB,MAAM8C,GAAOL,IACpEO,QAAQC,IAAI,uCAAS1B,EAAOvB,MAAM8C,GAAOH,QACzCK,QAAQC,IAAI,4BAAO,IAAIC,MAAOC,WAC3B5B,EAAOvB,MAAM8C,GAAOH,QAAS,IAAIO,MAAOC,UACvCC,EAAAA,EAAAA,QAAc,8FAGfL,GAAY,EACbK,EAAAA,EAAAA,QAAc,iHAGhB5B,EAAa6B,qBAAoB,GACjC7B,EAAa8B,wBACX,SAAC,EAA2B,CAACpD,SAAUqB,EAAOvB,MAAM8C,GAAO5C,SAAUC,mBAAoB,SAACoD,GAAE,OAvCpE,SAACA,EAAST,GACpC,OAAQS,GACN,IAAK,SACHP,QAAQC,IAAI,wBAAyBH,GACrC,MACF,IAAK,OACHtB,EAAa6B,qBAAoB,GACjCL,QAAQC,IAAI1B,EAAOvB,OACnBqB,EAAK,cAAe,CAAEkB,MAAOhB,EAAOvB,MAAM8C,KAC1C,MACF,IAAK,QAGH,GAFAE,QAAQC,IAAI,uBAAwBH,GACpCtB,EAAa6B,qBAAoB,GACC,GAA/B9B,EAAOvB,MAAM8C,GAAOF,QAAa,CAClCQ,EAAAA,EAAAA,QAAc,wIACd,KACF,CACA/B,EAAK,uBAAwB,CAAEkB,MAAOhB,EAAOvB,MAAM8C,KACnD,MACF,IAAK,SACHtB,EAAa6B,qBAAoB,GACjChC,EAAK,qBAAsB,CAACkB,MAAMhB,EAAOvB,MAAM8C,KAGrD,CAeqGU,CAAoBD,EAAIT,EAAM,KAEnI,EAEA,OACE,SAACW,EAAA,EAAI,CAACC,IAAI,EAAK,UACb,SAACpD,EAAA,EAAG,WACF,SAACK,EAAA,EAAY,CAACC,MAAmB,QAAd,EAAEW,EAAOvB,aAAK,aAAZ,EAAckC,KAAI,SAACyB,EAAab,GACnD,OAAO,SAACc,EAAA,EAAQ,CAEd1D,SAAUyD,EAAYzD,SACtB2D,UAAUC,EAAAA,EAAAA,GAAkBH,EAAYhB,QACxCL,UAAUyB,EAAAA,EAAAA,GAAaJ,EAAYrB,UACnC0B,UAAWL,EAAYjB,SAAWiB,EAAYlB,IAC9CwB,eAAe,SAACC,EAAA,EAAS,CAAC3B,MAAO,eACjCpC,mBAAoB,kBAAMA,EAAmB2C,EAAM,GAN9CA,EAOT,IAAIqB,cAAehE,OAI3B,EC9FA,EARuB,WACnB,OACI,SAAC,KAAQ,CAACiE,GAAI3E,EAAgB,UAC1B,SAAC4E,EAAiB,KAG9B,C","sources":["states/page/file-share/sharedtome/index.ts","components/file-share/shared-to-me/ShredToMeFileOperationMenu/index.tsx","components/file-share/shared-to-me/SharedToMe.tsx","pages/file-share/SharedToMe.tsx"],"sourcesContent":["import { Dispatch, SetStateAction, useState } from 'react'\r\nimport { useStore } from 'reto'\r\nimport { BeSharedFile } from 'src/service/medic'\r\nimport { ConfirmDeleteDialogStore } from 'src/states/common/ConfirmDeleteDialogStore'\r\nimport { LoadingStore } from 'src/states/common/LoadingStore'\r\n\r\n\r\n// 新建数据通道\r\nexport interface SharedToMeStates {\r\n  files: BeSharedFile[]\r\n}\r\n\r\nexport interface SharedToMeStore\r\n  extends SharedToMeStates,\r\n  LoadingStore {\r\n  setFiles: Dispatch<SetStateAction<any[]>>\r\n}\r\n\r\nexport function SharedToMeStore(): SharedToMeStore {\r\n  const loadingStore = useStore(LoadingStore)\r\n  const confirmDeleteDialogStore = useStore(ConfirmDeleteDialogStore)\r\n  const [files, setFiles] = useState<any[]>([])\r\n  return {\r\n    ...loadingStore,\r\n    ...confirmDeleteDialogStore,\r\n    files,\r\n    setFiles\r\n  }\r\n}\r\n","import { Delete, ErrorOutline, Share } from '@material-ui/icons';\r\nimport { Box, Stack } from '@mui/material';\r\nimport { FolderArrowUp } from 'mdi-material-ui';\r\nimport OperationItem from 'src/components/common/OperationItem';\r\nimport Section from 'src/components/common/Section';\r\nimport SimpleFileItem from 'src/components/common/SimpleFileItem';\r\nimport VerticalList from 'src/components/common/VerticalList';\r\nimport { FileOperationMenuProps } from '../../../../types/ComponentProps';\r\n\r\n\r\n// 触发菜单向处理函数传递参数，执行对应的逻辑\r\nconst ShredToMeFileOperationMenu = ({ fileName, onOperationClicked }: FileOperationMenuProps) => {\r\n    return (\r\n        <Stack m={1}>\r\n            <Box borderRadius={3}>\r\n                <SimpleFileItem fileName={fileName} />\r\n                <Section title='文件操作'>\r\n                    <VerticalList items={[\r\n                        <OperationItem icon={<FolderArrowUp fontSize='large' />} name={'打开'} onclick={() => onOperationClicked('open')} />,\r\n                        <OperationItem icon={<Share fontSize='large' />} name={'共享'} onclick={() => onOperationClicked('share')} />,\r\n                    ]} />\r\n                </Section>\r\n                <Section title='更多操作'>\r\n                    <VerticalList items={[\r\n                        <OperationItem icon={<ErrorOutline fontSize='large' />} name={'详细信息'} onclick={() => onOperationClicked('detail')} />\r\n                    ]} />\r\n                </Section>\r\n            </Box>\r\n\r\n        </Stack>\r\n    )\r\n\r\n}\r\n\r\n\r\nexport default ShredToMeFileOperationMenu\r\n","import { Box, Fade } from \"@mui/material\"\r\nimport { useEffect } from \"react\"\r\nimport { useNavigate } from \"react-router\"\r\nimport { useStore } from 'reto'\r\nimport FileState from \"src/components/common/FileState\"\r\nimport { getPolicies } from \"src/service/policyApi\"\r\nimport { SharedToMeStore } from \"src/states/page/file-share/sharedtome\"\r\nimport { BottomDrawerStore } from '../../../states/global/BottomDrawerStore'\r\nimport FileItem from \"../../common/FileItem\"\r\nimport VerticalList from \"../../common/VerticalList\"\r\nimport SharedToMeFileOperationMenu from \"./ShredToMeFileOperationMenu\"\r\nimport { FileToFileItemData, getFileList, myBeShareFile } from \"src/service/medic\"\r\nimport { toLocalTimeString } from \"src/utils/time\"\r\nimport { sizeToString } from \"src/utils/sizeToString\"\r\nimport Toast from \"src/components/common/Toast\"\r\n\r\nconst SharedToMeWrapper = () => {\r\n  const navi = useNavigate()\r\n  const states = useStore(SharedToMeStore)\r\n  const drawerStates = useStore(BottomDrawerStore)\r\n  useEffect(() => {\r\n    myBeShareFile().then(res => {\r\n      if (res && res.code === 200) {\r\n        if (Array.isArray(res.data)) {\r\n          states.setFiles(res.data.map((item, idx) => {\r\n            return {\r\n                id: item.id,\r\n                fileName: item.fileName,\r\n                fileSize: item.fileSize,\r\n                state: 'shared',\r\n                from: item.from,\r\n                use: item.use,\r\n                useLimit: item.useLimit,\r\n                expire: item.expire,\r\n                isAllow:item.isAllow\r\n            }\r\n          }))\r\n          states.setLoading(false)\r\n        } else {\r\n          states.setFiles([res.data])\r\n        }\r\n      }\r\n    })\r\n  }, [])\r\n\r\n  // 处理菜单按钮\r\n  const handleFileOperation = (ty: any, index: number) => {\r\n    switch (ty) {\r\n      case 'delete':\r\n        console.log('delete files at index', index);\r\n        break;\r\n      case 'open':\r\n        drawerStates.setBottomDrawerOpen(false)\r\n        console.log(states.files)\r\n        navi('/pdfpreview', { state: states.files[index] })//传入Id值\r\n        break;\r\n      case 'share':\r\n        console.log('share files at index', index);\r\n        drawerStates.setBottomDrawerOpen(false)\r\n        if(states.files[index].isAllow != 1){\r\n          Toast.warning(\"当前病历并未分配共享权限，请联系共享来源用户\")\r\n          break;\r\n        }\r\n        navi('/policymanage/create', { state: states.files[index] })//传入Id值\r\n        break;\r\n      case 'detail':\r\n        drawerStates.setBottomDrawerOpen(false)\r\n        navi('/fileshare/details', {state:states.files[index]})\r\n        break;\r\n    }\r\n  }\r\n  const onOperationClicked = (index: number) => {\r\n    const validNum = states.files[index].useLimit - states.files[index].use\r\n    console.log(\"文件过期时间\",states.files[index].expire)\r\n    console.log(\"当前时间\",new Date().getTime())\r\n    if(states.files[index].expire < new Date().getTime()){\r\n        Toast.warning(\"该文件已过期，请联系病历拥有者\")\r\n        return;\r\n    }\r\n    if(validNum <= 0){\r\n      Toast.warning(\"该文件已被使用完毕，请联系文件拥有者\")\r\n      return;\r\n    }\r\n    drawerStates.setBottomDrawerOpen(true)\r\n    drawerStates.setBottomDrawerContent(\r\n      <SharedToMeFileOperationMenu fileName={states.files[index].fileName} onOperationClicked={(ty) => handleFileOperation(ty, index)} />\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Fade in={true}>\r\n      <Box>\r\n        <VerticalList items={states.files?.map((SharedItems, index) => {\r\n          return <FileItem\r\n            key={index}\r\n            fileName={SharedItems.fileName}\r\n            fileTime={toLocalTimeString(SharedItems.expire)}\r\n            fileSize={sizeToString(SharedItems.fileSize)}\r\n            remainUse={SharedItems.useLimit - SharedItems.use}\r\n            sharedContent={<FileState state={'fromShared'} />}\r\n            onOperationClicked={() => onOperationClicked(index)} />\r\n        })} onItemClicked={onOperationClicked} />\r\n      </Box>\r\n    </Fade>\r\n  )\r\n}\r\nexport default SharedToMeWrapper\r\n","import { Provider } from 'reto';\r\nimport SharedToMeWrapper from '../../components/file-share/shared-to-me/SharedToMe';\r\nimport { SharedToMeStore } from '../../states/page/file-share/sharedtome/index';\r\nconst SharedToMePage = () => {\r\n    return (\r\n        <Provider of={SharedToMeStore}>\r\n            <SharedToMeWrapper />\r\n        </Provider>\r\n    )\r\n}\r\n\r\nexport default SharedToMePage\r\n"],"names":["SharedToMeStore","loadingStore","useStore","LoadingStore","confirmDeleteDialogStore","ConfirmDeleteDialogStore","useState","files","setFiles","fileName","onOperationClicked","Stack","m","Box","borderRadius","SimpleFileItem","Section","title","VerticalList","items","OperationItem","icon","FolderArrowUp","fontSize","name","onclick","Share","ErrorOutline","navi","useNavigate","states","drawerStates","BottomDrawerStore","useEffect","myBeShareFile","then","res","code","Array","isArray","data","map","item","idx","id","fileSize","state","from","use","useLimit","expire","isAllow","setLoading","index","validNum","console","log","Date","getTime","Toast","setBottomDrawerOpen","setBottomDrawerContent","ty","handleFileOperation","Fade","in","SharedItems","FileItem","fileTime","toLocalTimeString","sizeToString","remainUse","sharedContent","FileState","onItemClicked","of","SharedToMe"],"sourceRoot":""}