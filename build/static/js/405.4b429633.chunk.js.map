{"version":3,"file":"static/js/405.4b429633.chunk.js","mappings":"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","sources":["components/common/FileList/index.tsx","components/file-manage/FileOperationMenu/index.tsx","components/file-manage/index.tsx","pages/file-manage/index.tsx","styles/NoUserSelect.ts"],"sourcesContent":["import { sizeToString } from 'src/utils/sizeToString';\r\nimport { toLocalTimeString } from 'src/utils/time';\r\nimport { FileListProps } from '../../../types/ComponentProps';\r\nimport FileItem from \"../FileItem\";\r\nimport FileState from '../FileState';\r\nimport VerticalList from \"../VerticalList\";\r\n\r\n\r\nconst FileList = ({ items, onOperationClicked }: FileListProps) => {\r\n    return (\r\n        <VerticalList items={\r\n            items.map((item, index) => {\r\n                return <FileItem key={index}\r\n                    fileName={item.fileName}\r\n                    fileSize={sizeToString(item.size)}\r\n                    fileTime={toLocalTimeString(item.expire)}\r\n                    remainUse={item.useLimit - item.use}\r\n                    sharedContent={<FileState state={item.state} />}\r\n                    onOperationClicked={() => onOperationClicked(index)}\r\n                />\r\n            })\r\n        } />\r\n    )\r\n\r\n}\r\n\r\n\r\nexport default FileList\r\n","import { Delete, ErrorOutline, Share } from '@material-ui/icons';\r\nimport { Box, Stack } from '@mui/material';\r\nimport { FolderArrowUp } from 'mdi-material-ui';\r\nimport OperationItem from 'src/components/common/OperationItem';\r\nimport Section from 'src/components/common/Section';\r\nimport SimpleFileItem from 'src/components/common/SimpleFileItem';\r\nimport VerticalList from 'src/components/common/VerticalList';\r\nimport { FileOperationMenuProps } from '../../../types/ComponentProps';\r\n\r\n\r\n\r\nconst FileOperationMenu = ({ fileName, onOperationClicked }: FileOperationMenuProps) => {\r\n    return (\r\n        <Stack m={1}>\r\n            <Box borderRadius={5}>\r\n                <SimpleFileItem fileName={fileName} />\r\n                <Section title='文件操作'>\r\n                    <VerticalList items={[\r\n                        <OperationItem icon={<FolderArrowUp fontSize='large' />} name={'打开'} onclick={() => onOperationClicked('open')} />,\r\n                        <OperationItem icon={<Share fontSize='large' />} name={'共享'} onclick={() => onOperationClicked('share')} />\r\n                    ]} />\r\n                </Section>\r\n                <Section title='更多操作'>\r\n                    <VerticalList items={[\r\n                        <OperationItem icon={<ErrorOutline fontSize='large' />} name={'详细信息'} onclick={() => onOperationClicked('detail')} />\r\n                    ]} />\r\n                </Section>\r\n            </Box>\r\n\r\n        </Stack>\r\n    )\r\n\r\n}\r\n\r\n\r\nexport default FileOperationMenu\r\n","import { BottomDrawerStore } from \"src/states/global/BottomDrawerStore\";\r\nimport { FileItemData, FileManageOperationType, SpeedDialMenuOptionProps } from \"src/types/ComponentProps\";\r\nimport { Fade, Stack, Zoom } from \"@mui/material\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useStore, Provider } from \"reto\";\r\nimport FileList from 'src/components/common/FileList';\r\nimport Section from \"../common/Section\";\r\nimport FileOperationMenu from \"./FileOperationMenu\";\r\nimport { noUserSelect } from \"src/styles/NoUserSelect\";\r\nimport SpeedDialMenu from \"../common/PopMenu\";\r\nimport { Favorite, FileCopy, Print, Save, Share } from \"@material-ui/icons\";\r\nimport { BookOutline } from \"mdi-material-ui\";\r\nimport { useNavigate } from \"react-router\";\r\nimport { bool } from \"prop-types\";\r\nimport { getFileList } from \"src/service/medic\"\r\nimport Toast from \"../common/Toast\";\r\nimport { toLocalTimeString } from \"src/utils/time\";\r\nconst FileManageWrapper = () => {\r\n    const bottomeDrawerStates = useStore(BottomDrawerStore)\r\n    const navi = useNavigate()\r\n    const [files, setFiles] = useState<FileItemData[]>([]);\r\n    // 使用 useEffect 来在组件挂载后获取数据\r\n    useEffect(() => {\r\n        // 获取文件数据\r\n        getFileList().then((res) => {\r\n            setFiles(res.data.map((item, idx) => {\r\n                const owner = localStorage.getItem('userName')\r\n                return {\r\n                    id: idx,\r\n                    fileName: item.fileName,\r\n                    size: item.fileSize,\r\n                    state: owner == item.owner ? 'owned' : 'fromShared',\r\n                    owner: item.owner,\r\n                    use: item.use,\r\n                    useLimit: item.useLimit,\r\n                    expire: item.expire,\r\n                    isAllow:item.isAllow\r\n                }\r\n            }))\r\n        })\r\n    }, []); // 空依赖数组意味着这个 useEffect 只会在组件挂载后执行一次\r\n\r\n    const handleFileOperation = (ty: FileManageOperationType, index: number) => {\r\n        switch (ty) {\r\n            case 'delete':\r\n                console.log('delete files at index', index);\r\n                break;\r\n            case 'open':\r\n                bottomeDrawerStates.setBottomDrawerOpen(false)\r\n                navi('/pdfpreview', { state: files[index] })//传入Id值\r\n                break;\r\n            case 'share':\r\n                bottomeDrawerStates.setBottomDrawerOpen(false)\r\n                if(files[index].isAllow != 1){\r\n                    Toast.warning(\"当前病历并未分配共享权限，请联系共享来源用户\")\r\n                    break;\r\n                }   \r\n                navi('/policymanage/create', { state: files[index] })//传入Id值\r\n                break;\r\n            case 'detail':\r\n                bottomeDrawerStates.setBottomDrawerOpen(false)\r\n                navi('/fileshare/details', {state:files[index]})\r\n                break;\r\n        }\r\n    }\r\n\r\n    const onOperationClickHandler = (index: number) => {\r\n        const validNum = files[index].useLimit - files[index].use\r\n        console.log(\"文件过期时间\",files[index].expire)\r\n        console.log(\"当前时间\",new Date().getTime())\r\n        if(files[index].expire < new Date().getTime()){\r\n            Toast.warning(\"该文件已过期，请联系病历拥有者\")\r\n            return;\r\n        }\r\n        if(validNum <= 0){\r\n            Toast.warning(\"该文件已被使用次数用完，请联系病历拥有者\")\r\n            return;\r\n        }\r\n        bottomeDrawerStates.setBottomDrawerOpen(true)\r\n        bottomeDrawerStates.setBottomDrawerContent(\r\n            <FileOperationMenu fileName={files[index].fileName} onOperationClicked={(ty) => handleFileOperation(ty, index)} />\r\n        )\r\n    }\r\n    const noSelect = noUserSelect()\r\n    return (\r\n        <Fade in={true}>\r\n            <Stack className={noSelect.root}>\r\n                <Section title={'所有文件'}>\r\n                    <FileList items={files} onOperationClicked={onOperationClickHandler} />\r\n                </Section>\r\n                {/* <SpeedDialMenu options={actions} /> */}\r\n            </Stack>\r\n        </Fade>\r\n    )\r\n}\r\nexport default FileManageWrapper\r\n","// ** MUI Imports\r\n// ** Icons Imports\r\n// ** Demo Components Imports\r\nimport FileManageWrapper from 'src/components/file-manage';\r\n\r\nconst FileManagePage = () => {\r\n  return <FileManageWrapper />\r\n}\r\n\r\nexport default FileManagePage\r\n","import { makeStyles } from \"@material-ui/core\";\r\n\r\nexport const noUserSelect = makeStyles({\r\n    root: {\r\n        '& > *': { userSelect: 'none' }\r\n    }\r\n})\r\n"],"names":["items","onOperationClicked","VerticalList","map","item","index","FileItem","fileName","fileSize","sizeToString","size","fileTime","toLocalTimeString","expire","remainUse","useLimit","use","sharedContent","FileState","state","Stack","m","Box","borderRadius","SimpleFileItem","Section","title","OperationItem","icon","FolderArrowUp","fontSize","name","onclick","Share","ErrorOutline","bottomeDrawerStates","useStore","BottomDrawerStore","navi","useNavigate","useState","files","setFiles","useEffect","getFileList","then","res","data","idx","owner","localStorage","getItem","id","isAllow","noSelect","noUserSelect","Fade","in","className","root","validNum","console","log","Date","getTime","Toast","setBottomDrawerOpen","setBottomDrawerContent","ty","handleFileOperation","makeStyles","userSelect"],"sourceRoot":""}